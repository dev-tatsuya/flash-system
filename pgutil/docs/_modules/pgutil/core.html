
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="jp">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>pgutil.core &#8212; pgutil 1.0.0 documentation</title>
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">pgutil 1.0.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for pgutil.core</h1><div class="highlight"><pre>
<span></span><span class="c1"># coding: UTF-8</span>

<span class="kn">import</span> <span class="nn">pygame</span>
<span class="kn">import</span> <span class="nn">pgutil._keyutil</span> <span class="k">as</span> <span class="nn">keyutil</span>
<span class="kn">import</span> <span class="nn">pgutil._drawutil</span> <span class="k">as</span> <span class="nn">drawutil</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="k">import</span> <span class="n">ctime</span>
<span class="kn">from</span> <span class="nn">OpenGL.GL</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">OpenGL.GLU</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">matplotlib.cm</span> <span class="k">as</span> <span class="nn">cm</span>
<span class="kn">from</span> <span class="nn">skimage</span> <span class="k">import</span> <span class="n">measure</span>


<span class="k">def</span> <span class="nf">_get_surf_array</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">maxinput</span><span class="p">,</span> <span class="n">col</span><span class="p">):</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="n">data</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">maxinput</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="p">(</span><span class="n">temp</span> <span class="o">*</span> <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
    <span class="n">g</span> <span class="o">=</span> <span class="p">(</span><span class="n">temp</span> <span class="o">*</span> <span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">temp</span> <span class="o">*</span> <span class="n">col</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">_blit_array</span><span class="p">(</span><span class="n">screen</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">maxinput</span><span class="p">,</span> <span class="n">mininput</span><span class="p">,</span> <span class="n">col</span><span class="p">):</span>
    <span class="n">pygame</span><span class="o">.</span><span class="n">surfarray</span><span class="o">.</span><span class="n">pixels3d</span><span class="p">(</span><span class="n">screen</span><span class="p">)[:]</span> <span class="o">=</span> <span class="n">_get_surf_array</span><span class="p">(</span><span class="n">array</span> <span class="o">-</span> <span class="n">mininput</span><span class="p">,</span> <span class="n">maxinput</span> <span class="o">-</span> <span class="n">mininput</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_blit_array_3d</span><span class="p">(</span><span class="n">screen</span><span class="p">,</span> <span class="n">array</span><span class="p">):</span>
    <span class="n">pygame</span><span class="o">.</span><span class="n">surfarray</span><span class="o">.</span><span class="n">pixels3d</span><span class="p">(</span><span class="n">screen</span><span class="p">)[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_gen_mesh_index</span><span class="p">(</span><span class="n">shape</span><span class="p">):</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">shape</span>
    <span class="n">index</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">j</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">x</span> <span class="o">-</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">y</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">i</span> <span class="o">-</span> <span class="n">j</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">y</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">i</span> <span class="o">-</span> <span class="n">j</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>

    <span class="n">yf</span><span class="p">,</span> <span class="n">xf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

    <span class="n">draw_cahe</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">xf</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">yf</span><span class="o">.</span><span class="n">ravel</span><span class="p">()))</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> <span class="n">draw_cahe</span>


<span class="k">def</span> <span class="nf">_get_edges</span><span class="p">(</span><span class="n">array</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">w</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">d</span>
    <span class="n">offs</span> <span class="o">=</span> <span class="n">w</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">[[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]],</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]])</span>

    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
                          <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
                          <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">temp</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:]</span>
            <span class="n">temp</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="n">array</span><span class="p">[:]</span>
        <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">temp</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:]</span>
            <span class="n">temp</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="n">array</span><span class="p">[:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">temp</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:]</span>
            <span class="n">temp</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">-=</span> <span class="n">array</span><span class="p">[:]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]:</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">temp</span> <span class="o">==</span> <span class="n">j</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="n">mask</span><span class="p">]])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">second</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="n">offs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">third</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="n">offs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">fourth</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="n">offs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">start</span><span class="p">,</span> <span class="n">second</span><span class="p">,</span> <span class="n">third</span><span class="p">,</span> <span class="n">fourth</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">start</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">results</span>


<span class="k">def</span> <span class="nf">_get_tex_array</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">font</span><span class="p">):</span>
    <span class="c1"># img = surfarray.array3d(font.render(text, False, (255, 255, 255))).astype(np.uint8)[:, :, 0]</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">surfarray</span><span class="o">.</span><span class="n">array3d</span><span class="p">(</span><span class="n">_render_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">font</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="n">img</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">img</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">_load_texture</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">font</span><span class="p">):</span>
    <span class="n">tex_num</span> <span class="o">=</span> <span class="n">glGenTextures</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">_get_tex_array</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">font</span><span class="p">)</span>
    <span class="n">glBindTexture</span><span class="p">(</span><span class="n">GL_TEXTURE_2D</span><span class="p">,</span> <span class="n">tex_num</span><span class="p">)</span>
    <span class="n">glTexImage2D</span><span class="p">(</span><span class="n">GL_TEXTURE_2D</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">GL_RGBA</span><span class="p">,</span> <span class="n">im</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">im</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">GL_RGBA</span><span class="p">,</span> <span class="n">GL_UNSIGNED_BYTE</span><span class="p">,</span> <span class="n">im</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tex_num</span><span class="p">,</span> <span class="n">im</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">_render_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">font</span><span class="p">):</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">surfs</span> <span class="o">=</span> <span class="p">[</span><span class="n">font</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">))</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">]</span>
    <span class="n">width</span> <span class="o">=</span> <span class="n">surfs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_width</span><span class="p">()</span>
    <span class="n">height</span> <span class="o">=</span> <span class="n">surfs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_height</span><span class="p">()</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">Surface</span><span class="p">((</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">surfs</span><span class="p">)))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">surfs</span><span class="p">)):</span>
        <span class="n">res</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="n">surfs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span> <span class="o">*</span> <span class="n">height</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">res</span>


<span class="k">def</span> <span class="nf">_gen_cube</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">,</span> <span class="n">z_min</span><span class="p">,</span> <span class="n">z_max</span><span class="p">):</span>
    <span class="n">lims</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">,</span> <span class="n">z_min</span><span class="p">,</span> <span class="n">z_max</span><span class="p">])</span>

    <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="n">ind0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
    <span class="n">points</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lims</span><span class="p">[</span><span class="n">ind0</span> <span class="o">//</span> <span class="mi">1</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">points</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">lims</span><span class="p">[</span><span class="n">ind0</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span>
    <span class="n">points</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">lims</span><span class="p">[</span><span class="n">ind0</span> <span class="o">//</span> <span class="mi">4</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span>
    <span class="n">inds</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="n">inds</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">result</span><span class="p">,</span> <span class="p">(</span><span class="n">result</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span>


<div class="viewcode-block" id="__PgBase"><a class="viewcode-back" href="../../pgutil.html#pgutil.core.__PgBase">[docs]</a><span class="k">class</span> <span class="nc">__PgBase</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;PlaygroundとGLgroundのベースとなるクラス.</span>

<span class="sd">    このクラスのメンバ関数はPlaygroundとGLgroundの両方から呼び出すことができます.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    w_ : int, optional</span>
<span class="sd">        ウィンドウの幅,</span>
<span class="sd">        デフォルト値は500.</span>
<span class="sd">    h_ : int, optional</span>
<span class="sd">        ウィンドウの高さ,</span>
<span class="sd">        デフォルト値は500.</span>
<span class="sd">    name : str, optional</span>
<span class="sd">        ウィンドウのタイトル,</span>
<span class="sd">        デフォルト値は&quot;PgBase&quot;.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    size : tuple of int</span>
<span class="sd">        現在のウィンドウのサイズ.</span>
<span class="sd">    col : tuple of int</span>
<span class="sd">        いくつかの描画関数で使用されるデフォルトの色.</span>
<span class="sd">    back_col : tuple of int</span>
<span class="sd">        現在の背景色, PlaygroundとGLgroundの両方で有効.</span>
<span class="sd">    screen : pygame.Surface</span>
<span class="sd">        ウィンドウのpygame.Surfaceオブジェクト. pygameの機能を直接呼び出すときに使用する.</span>
<span class="sd">    ticking : bool</span>
<span class="sd">        spaceキーでTrue/Falseが切替可能なフラグ.</span>
<span class="sd">    totaltick : int</span>
<span class="sd">        ウィンドウ生成時からのフレーム数. tickingがFalseのときはカウントが増加しない.</span>
<span class="sd">    debug_flag : bool</span>
<span class="sd">        F3キーでTrue/Falseが切替可能なフラグ. Trueの間タイトルバーにfpsが表示される.</span>
<span class="sd">    mouse : tuple of int</span>
<span class="sd">        現在のマウスの位置を表すタプル.</span>


<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w_</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">h_</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;PgBase&quot;</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">initial_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">w_</span><span class="p">,</span> <span class="n">h_</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">col</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">back_col</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">pygame</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fullscreen_flag</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">Info</span><span class="p">()</span><span class="o">.</span><span class="n">current_w</span><span class="p">,</span> <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">Info</span><span class="p">()</span><span class="o">.</span><span class="n">current_h</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">screen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_screen</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fullscreen_flag</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">name</span>
        <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_caption</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">clock</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">Clock</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">totaltick</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ticking</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug_flag</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">running</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exit_flag</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mouse</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mouseX</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouseY</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouse</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mousedownfuncs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mouseupfuncs</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">keyfuncs</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">screenmodefuncs</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">debug_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cmap_cache</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">screenshot_flag</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">Font</span><span class="p">(</span><span class="n">font</span><span class="o">.</span><span class="n">match_font</span><span class="p">(</span><span class="s2">&quot;arial&quot;</span><span class="p">),</span> <span class="mi">200</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Internal function for updating pygame window.</span>

<span class="sd">        Needs to be overridden.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_process_event</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Internal function for processing pygame events.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">pygame</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">get</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">QUIT</span> <span class="ow">or</span> <span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">KEYDOWN</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">K_ESCAPE</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">running</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">KEYDOWN</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyfuncs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">keyfuncs</span><span class="p">[</span><span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">]()</span>
            <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">MOUSEBUTTONDOWN</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mousedownfuncs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mousedownfuncs</span><span class="p">[</span><span class="n">event</span><span class="o">.</span><span class="n">button</span><span class="p">](</span><span class="n">event</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">MOUSEBUTTONUP</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouseupfuncs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mouseupfuncs</span><span class="p">[</span><span class="n">event</span><span class="o">.</span><span class="n">button</span><span class="p">](</span><span class="n">event</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">KEYDOWN</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">K_SPACE</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ticking</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ticking</span>
            <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">KEYDOWN</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">K_F2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">screenshot_flag</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">KEYDOWN</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">K_F3</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">debug_flag</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_flag</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_flag</span><span class="p">:</span>
                    <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_caption</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">+</span> <span class="s2">&quot;  fps : &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_fps</span><span class="p">()</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span> <span class="o">/</span> <span class="mi">10</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_caption</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">KEYDOWN</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="n">K_F11</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fullscreen_flag</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fullscreen_flag</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fullscreen_flag</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">display_size</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">screen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_screen</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fullscreen_flag</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_size</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">screen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_screen</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fullscreen_flag</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">center</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">screenmodefuncs</span><span class="p">:</span>
                    <span class="n">func</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">MOUSEMOTION</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mouse</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">pos</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mouseX</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouseY</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouse</span>

    <span class="k">def</span> <span class="nf">_get_screen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">isfull</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Internal function for generating pygame screen surface.</span>

<span class="sd">        Needs to be overridden.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        isfull : bool, optional</span>
<span class="sd">            If set to True, the screen is initialized as full screen surface.</span>
<span class="sd">            Default value is False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_get_cmap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmap</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">cmap</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmap_cache</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cmap</span> <span class="o">==</span> <span class="s2">&quot;AVS&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cmap_cache</span><span class="p">[</span><span class="n">cmap</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;gist_rainbow&quot;</span><span class="p">)(</span><span class="n">i</span> <span class="o">/</span> <span class="mi">255</span> <span class="o">*</span> <span class="mi">16</span> <span class="o">/</span> <span class="mi">21</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">)])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)[:,</span>
                                        <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">cmap</span> <span class="o">==</span> <span class="s2">&quot;AVS_r&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cmap_cache</span><span class="p">[</span><span class="n">cmap</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;gist_rainbow&quot;</span><span class="p">)(</span><span class="n">i</span> <span class="o">/</span> <span class="mi">255</span> <span class="o">*</span> <span class="mi">16</span> <span class="o">/</span> <span class="mi">21</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">)])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)[:,</span>
                                        <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cmap_cache</span><span class="p">[</span><span class="n">cmap</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="p">)(</span><span class="n">i</span> <span class="o">/</span> <span class="mi">255</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">)])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)[:,</span>
                                        <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmap_cache</span><span class="p">[</span><span class="n">cmap</span><span class="p">]</span>

<div class="viewcode-block" id="__PgBase.get_fps"><a class="viewcode-back" href="../../pgutil.html#pgutil.core.__PgBase.get_fps">[docs]</a>    <span class="k">def</span> <span class="nf">get_fps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;現在のfps(frames per second)を返します.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        fps : float</span>
<span class="sd">            現在のfps.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clock</span><span class="o">.</span><span class="n">get_fps</span><span class="p">()</span></div>

<div class="viewcode-block" id="__PgBase.set_mouse_down_func"><a class="viewcode-back" href="../../pgutil.html#pgutil.core.__PgBase.set_mouse_down_func">[docs]</a>    <span class="k">def</span> <span class="nf">set_mouse_down_func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">button</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;マウスのボタンが押されたときに呼び出される関数を設定します.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        button : int</span>
<span class="sd">            マウスのボタン番号</span>
<span class="sd">            左クリックが1, 右クリックが3. 他のボタンも使用可能.</span>
<span class="sd">        func : function</span>
<span class="sd">            マウスのボタンが押されたときに呼び出される関数.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mousedownfuncs</span><span class="p">[</span><span class="n">button</span><span class="p">]</span> <span class="o">=</span> <span class="n">func</span></div>

<div class="viewcode-block" id="__PgBase.set_mouse_up_func"><a class="viewcode-back" href="../../pgutil.html#pgutil.core.__PgBase.set_mouse_up_func">[docs]</a>    <span class="k">def</span> <span class="nf">set_mouse_up_func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">button</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;マウスのボタンが離されたときに呼び出される関数を設定します.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        button : int</span>
<span class="sd">            マウスのボタン番号.</span>
<span class="sd">            左クリックが1, 右クリックが3. 他のボタンも使用可能.</span>
<span class="sd">        func : function</span>
<span class="sd">            マウスのボタンが離されたときに呼び出される関数.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mouseupfuncs</span><span class="p">[</span><span class="n">button</span><span class="p">]</span> <span class="o">=</span> <span class="n">func</span></div>

<div class="viewcode-block" id="__PgBase.set_key_func"><a class="viewcode-back" href="../../pgutil.html#pgutil.core.__PgBase.set_key_func">[docs]</a>    <span class="k">def</span> <span class="nf">set_key_func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;特定のキーが押されたときに呼び出される関数を設定します.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        button : int or str</span>
<span class="sd">            キー番号もしくはキーの名前. キー番号はpgutil.K_F1などのようにして取得可能. キーの名前は&quot;F1&quot;などとして設定可能。</span>
<span class="sd">        func : function</span>
<span class="sd">            キーが押されたときに呼び出される関数.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keyfuncs</span><span class="p">[</span><span class="n">keyutil</span><span class="o">.</span><span class="n">get_key</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span> <span class="o">=</span> <span class="n">func</span></div>

<div class="viewcode-block" id="__PgBase.mousedownfunc"><a class="viewcode-back" href="../../pgutil.html#pgutil.core.__PgBase.mousedownfunc">[docs]</a>    <span class="k">def</span> <span class="nf">mousedownfunc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">button</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;マウスのボタンが押されたときに呼び出される関数を設定するデコレータです.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        button : int</span>
<span class="sd">            マウスのボタン番号</span>
<span class="sd">            左クリックが1, 右クリックが3. 他のボタンも使用可能.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mousedownfuncs</span><span class="p">[</span><span class="n">button</span><span class="p">]</span> <span class="o">=</span> <span class="n">func</span>
            <span class="k">return</span> <span class="n">func</span>

        <span class="k">return</span> <span class="n">register</span></div>

<div class="viewcode-block" id="__PgBase.mouseupfunc"><a class="viewcode-back" href="../../pgutil.html#pgutil.core.__PgBase.mouseupfunc">[docs]</a>    <span class="k">def</span> <span class="nf">mouseupfunc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">button</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;マウスのボタンが離されたときに呼び出される関数を設定するデコレータです.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        button : int</span>
<span class="sd">            マウスのボタン番号</span>
<span class="sd">            左クリックが1, 右クリックが3. 他のボタンも使用可能.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mouseupfuncs</span><span class="p">[</span><span class="n">button</span><span class="p">]</span> <span class="o">=</span> <span class="n">func</span>
            <span class="k">return</span> <span class="n">func</span>

        <span class="k">return</span> <span class="n">register</span></div>

<div class="viewcode-block" id="__PgBase.keyfunc"><a class="viewcode-back" href="../../pgutil.html#pgutil.core.__PgBase.keyfunc">[docs]</a>    <span class="k">def</span> <span class="nf">keyfunc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;特定のキーが押されたときに呼び出される関数を設定するデコレータです.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        button : int or str</span>
<span class="sd">            キー番号もしくはキーの名前. キー番号はpgutil.K_F1などのようにして取得可能. キーの名前は&quot;F1&quot;などとして設定可能。</span>
<span class="sd">        func : function</span>
<span class="sd">            キーが押されたときに呼び出される関数.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">keyfuncs</span><span class="p">[</span><span class="n">keyutil</span><span class="o">.</span><span class="n">get_key</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span> <span class="o">=</span> <span class="n">func</span>
            <span class="k">return</span> <span class="n">func</span>

        <span class="k">return</span> <span class="n">register</span></div>

<div class="viewcode-block" id="__PgBase.set_screen_mode_func"><a class="viewcode-back" href="../../pgutil.html#pgutil.core.__PgBase.set_screen_mode_func">[docs]</a>    <span class="k">def</span> <span class="nf">set_screen_mode_func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;スクリーンモードが変更されたときに呼び出される関数を設定します.</span>

<span class="sd">        通常、スクリーンモードが切り替わるのはF11キーが押されて全画面モードと通常モードが切り替わったときです.</span>
<span class="sd">        対象の関数はこの関数で設定されたタイミングにも一度呼び出されます.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        func : function</span>
<span class="sd">            スクリーンモードが変更されたときに呼び出される関数</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">screenmodefuncs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
        <span class="n">func</span><span class="p">()</span></div>

<div class="viewcode-block" id="__PgBase.screenmodefunc"><a class="viewcode-back" href="../../pgutil.html#pgutil.core.__PgBase.screenmodefunc">[docs]</a>    <span class="k">def</span> <span class="nf">screenmodefunc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;スクリーンモードが変更されたときに呼び出される関数を設定するデコレータです.</span>

<span class="sd">        通常、スクリーンモードが切り替わるのはF11キーが押されて全画面モードと通常モードが切り替わったときです.</span>
<span class="sd">        対象の関数はこの関数で設定されたタイミングにも一度呼び出されます.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        func : function</span>
<span class="sd">            スクリーンモードが変更されたときに呼び出される関数</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screenmodefuncs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
            <span class="n">func</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">func</span>

        <span class="k">return</span> <span class="n">register</span></div>

<div class="viewcode-block" id="__PgBase.take_screenshot"><a class="viewcode-back" href="../../pgutil.html#pgutil.core.__PgBase.take_screenshot">[docs]</a>    <span class="k">def</span> <span class="nf">take_screenshot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;PNG形式でスクリーンショットを撮影します.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str, optional</span>
<span class="sd">            保存するファイルの名前.</span>
<span class="sd">            指定しない場合は現在の日付と時刻が使用される.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="ow">or</span> <span class="n">ctime</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.png&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.PNG&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">pygame</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="p">,</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.png&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="__PgBase.run"><a class="viewcode-back" href="../../pgutil.html#pgutil.core.__PgBase.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;画面の更新とpygameのイベントの処理を行います.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        flag : bool</span>
<span class="sd">            ウィンドウが閉じられていない場合, Trueを返す.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">running</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_process_event</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">True</span></div></div>


<div class="viewcode-block" id="Playground"><a class="viewcode-back" href="../../pgutil.html#pgutil.core.Playground">[docs]</a><span class="k">class</span> <span class="nc">Playground</span><span class="p">(</span><span class="n">__PgBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;2次元データの可視化用のクラス.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    w_ : int, optional</span>
<span class="sd">        ウィンドウの幅,</span>
<span class="sd">        デフォルト値は500.</span>
<span class="sd">    h_ : int, optional</span>
<span class="sd">        ウィンドウの高さ,</span>
<span class="sd">        デフォルト値は500.</span>
<span class="sd">    name : str, optional</span>
<span class="sd">        ウィンドウのタイトル,</span>
<span class="sd">        デフォルト値は&quot;Playground&quot;.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    fill : bool</span>
<span class="sd">        ウィンドウを毎フレーム塗りつぶすかどうか. 塗りつぶす場合はback_colに指定された色で塗りつぶされる.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w_</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">h_</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Playground&quot;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">w_</span><span class="p">,</span> <span class="n">h_</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fill</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">surf_cache</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">draw</span> <span class="o">=</span> <span class="n">drawutil</span><span class="o">.</span><span class="n">DrawWrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gfxdraw</span> <span class="o">=</span> <span class="n">drawutil</span><span class="o">.</span><span class="n">GfxWrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Internal function for updating pygame window.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">running</span><span class="p">:</span>
            <span class="n">pygame</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exit_flag</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">screenshot_flag</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">take_screenshot</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screenshot_flag</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clock</span><span class="o">.</span><span class="n">tick</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fill</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">back_col</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ticking</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">totaltick</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_flag</span><span class="p">:</span>
            <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_caption</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">+</span> <span class="s2">&quot;  fps : &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_fps</span><span class="p">()</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">debug_list</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug_list</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="Playground.transform_blit"><a class="viewcode-back" href="../../pgutil.html#pgutil.core.Playground.transform_blit">[docs]</a>    <span class="k">def</span> <span class="nf">transform_blit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">minin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">maxin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">smallsurf</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;2次元配列を画像として表示する.</span>

<span class="sd">        値の小さい部分は暗く, 値の大きい部分は明るく表示される. 表示にはPlayground.colに保存された色が使用される.</span>
<span class="sd">        入力された配列は自動的に伸縮され, ウィンドウサイズに一致するようにして描画される.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        array : array_like</span>
<span class="sd">            表示する配列.</span>
<span class="sd">            2次元配列のみ表示が可能.</span>
<span class="sd">        minin : float, optional</span>
<span class="sd">            表示の際に最小として表示される値.</span>
<span class="sd">            これより小さい値は黒として表示される.</span>
<span class="sd">            指定がない場合は入力された配列の最小値が使用される.</span>
<span class="sd">        maxin : float, optional</span>
<span class="sd">            表示の際に最大として表示される値.</span>
<span class="sd">            これより大きい値はPlayground.colと同じ色で表示される.</span>
<span class="sd">            指定がない場合は入力された配列の最大値が使用される.</span>
<span class="sd">        smallsurf : pygame.Surface, optional</span>
<span class="sd">            自動伸縮を行う際に内部的に使用されるpygame.Surfaceオブジェクト.</span>
<span class="sd">            指定がない場合は自動的に生成され, 2回目以降の描画のためにキャッシュされる.</span>
<span class="sd">            殆どの場合, 変更の必要はありません.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">minin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">maxin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">minin</span><span class="p">,</span> <span class="n">maxin</span><span class="p">)</span>

        <span class="n">ma</span> <span class="o">=</span> <span class="n">maxin</span> <span class="k">if</span> <span class="n">maxin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">array</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">mi</span> <span class="o">=</span> <span class="n">minin</span> <span class="k">if</span> <span class="n">minin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">array</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">smallsurf</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">surf_cache</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">surf_cache</span><span class="p">[</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">Surface</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

            <span class="n">_blit_array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">surf_cache</span><span class="p">[</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">],</span> <span class="n">array</span><span class="p">,</span> <span class="n">ma</span><span class="p">,</span> <span class="n">mi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">)</span>
            <span class="n">pygame</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">surf_cache</span><span class="p">[</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_blit_array</span><span class="p">(</span><span class="n">smallsurf</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">ma</span><span class="p">,</span> <span class="n">mi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">)</span>
            <span class="n">pygame</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">smallsurf</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="p">)</span></div>

<div class="viewcode-block" id="Playground.transform_blit_smooth"><a class="viewcode-back" href="../../pgutil.html#pgutil.core.Playground.transform_blit_smooth">[docs]</a>    <span class="k">def</span> <span class="nf">transform_blit_smooth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">minin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">maxin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">smallsurf</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;2次元配列を画像として表示する.</span>

<span class="sd">        値の小さい部分は暗く, 値の大きい部分は明るく表示される. 表示にはPlayground.colに保存された色が使用される.</span>
<span class="sd">        入力された配列は自動的に伸縮され, ウィンドウサイズに一致するようにして描画される.</span>
<span class="sd">        伸縮の際には見た目がなめらかになるよう自動的に補完処理がなされる.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        array : array_like</span>
<span class="sd">            表示する配列.</span>
<span class="sd">            2次元配列のみ表示が可能.</span>
<span class="sd">        minin : float, optional</span>
<span class="sd">            表示の際に最小として表示される値.</span>
<span class="sd">            これより小さい値は黒として表示される.</span>
<span class="sd">            指定がない場合は入力された配列の最小値が使用される.</span>
<span class="sd">        maxin : float, optional</span>
<span class="sd">            表示の際に最大として表示される値.</span>
<span class="sd">            これより大きい値はPlayground.colと同じ色で表示される.</span>
<span class="sd">            指定がない場合は入力された配列の最大値が使用される.</span>
<span class="sd">        smallsurf : pygame.Surface, optional</span>
<span class="sd">            自動伸縮を行う際に内部的に使用されるpygame.Surfaceオブジェクト.</span>
<span class="sd">            指定がない場合は自動的に生成され, 2回目以降の描画のためにキャッシュされる.</span>
<span class="sd">            殆どの場合, 変更の必要はありません.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">minin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">maxin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">minin</span><span class="p">,</span> <span class="n">maxin</span><span class="p">)</span>

        <span class="n">ma</span> <span class="o">=</span> <span class="n">maxin</span> <span class="k">if</span> <span class="n">maxin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">array</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">mi</span> <span class="o">=</span> <span class="n">minin</span> <span class="k">if</span> <span class="n">minin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">array</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">smallsurf</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">surf_cache</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">surf_cache</span><span class="p">[</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">Surface</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

            <span class="n">_blit_array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">surf_cache</span><span class="p">[</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">],</span> <span class="n">array</span><span class="p">,</span> <span class="n">ma</span><span class="p">,</span> <span class="n">mi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">)</span>
            <span class="n">pygame</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">smoothscale</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">surf_cache</span><span class="p">[</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_blit_array</span><span class="p">(</span><span class="n">smallsurf</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">ma</span><span class="p">,</span> <span class="n">mi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">)</span>
            <span class="n">pygame</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">smoothscale</span><span class="p">(</span><span class="n">smallsurf</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="p">)</span></div>

<div class="viewcode-block" id="Playground.transform_blit_3d"><a class="viewcode-back" href="../../pgutil.html#pgutil.core.Playground.transform_blit_3d">[docs]</a>    <span class="k">def</span> <span class="nf">transform_blit_3d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">smallsurf</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;3次元配列を画像として表示する.</span>

<span class="sd">        3次元配列をRGBのピクセルデータとして解釈して表示する.</span>
<span class="sd">        入力された配列は自動的に伸縮され, ウィンドウサイズに一致するようにして描画される.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        array : array_like</span>
<span class="sd">            表示する配列.</span>
<span class="sd">            3次元配列のみ表示が可能.</span>
<span class="sd">            3次元目の要素数は3で, すべての値は0から255の範囲に入っている必要がある.</span>
<span class="sd">        smallsurf : pygame.Surface, optional</span>
<span class="sd">            自動伸縮を行う際に内部的に使用されるpygame.Surfaceオブジェクト.</span>
<span class="sd">            指定がない場合は自動的に生成され, 2回目以降の描画のためにキャッシュされる.</span>
<span class="sd">            殆どの場合, 変更の必要はありません.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">smallsurf</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">arrayshape</span> <span class="o">=</span> <span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">arrayshape</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">surf_cache</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">surf_cache</span><span class="p">[</span><span class="n">arrayshape</span><span class="p">]</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">Surface</span><span class="p">(</span><span class="n">arrayshape</span><span class="p">)</span>

            <span class="n">_blit_array_3d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">surf_cache</span><span class="p">[</span><span class="n">arrayshape</span><span class="p">],</span> <span class="n">array</span><span class="p">)</span>
            <span class="n">pygame</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">surf_cache</span><span class="p">[</span><span class="n">arrayshape</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_blit_array_3d</span><span class="p">(</span><span class="n">smallsurf</span><span class="p">,</span> <span class="n">array</span><span class="p">)</span>
            <span class="n">pygame</span><span class="o">.</span><span class="n">transform</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">smallsurf</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="p">)</span></div>

<div class="viewcode-block" id="Playground.transform_blit_cmap"><a class="viewcode-back" href="../../pgutil.html#pgutil.core.Playground.transform_blit_cmap">[docs]</a>    <span class="k">def</span> <span class="nf">transform_blit_cmap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">minin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">maxin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">smallsurf</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;2次元配列をカラー画像として表示する.</span>

<span class="sd">        2次元配列をカラーマップに従って描画し、画像として表示する.</span>
<span class="sd">        入力された配列は自動的に伸縮され, ウィンドウサイズに一致するようにして描画される.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        array : array_like</span>
<span class="sd">            表示する配列.</span>
<span class="sd">            2次元配列のみ表示が可能.</span>
<span class="sd">        minin : float, optional</span>
<span class="sd">            表示の際に最小として表示される値.</span>
<span class="sd">            これより小さい値は黒として表示される.</span>
<span class="sd">            指定がない場合は入力された配列の最小値が使用される.</span>
<span class="sd">        maxin : float, optional</span>
<span class="sd">            表示の際に最大として表示される値.</span>
<span class="sd">            これより大きい値はPlayground.colと同じ色で表示される.</span>
<span class="sd">            指定がない場合は入力された配列の最大値が使用される.</span>
<span class="sd">        cmap : str, optional</span>
<span class="sd">            描画に使用されるカラーマップ.</span>
<span class="sd">            matplotlibで使用可能なカラーマップ全てと&quot;AVS&quot;, &quot;AVS_r&quot;が使用可能.</span>
<span class="sd">            指定がない場合は&quot;vivid&quot;が選択される.</span>
<span class="sd">        smallsurf : pygame.Surface, optional</span>
<span class="sd">            自動伸縮を行う際に内部的に使用されるpygame.Surfaceオブジェクト.</span>
<span class="sd">            指定がない場合は自動的に生成され, 2回目以降の描画のためにキャッシュされる.</span>
<span class="sd">            殆どの場合, 変更の必要はありません.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">minin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">maxin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">minin</span><span class="p">,</span> <span class="n">maxin</span><span class="p">)</span>

        <span class="n">ma</span> <span class="o">=</span> <span class="n">maxin</span> <span class="k">if</span> <span class="n">maxin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">array</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">mi</span> <span class="o">=</span> <span class="n">minin</span> <span class="k">if</span> <span class="n">minin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">array</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>

        <span class="n">cmap_array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">transform_blit_3d</span><span class="p">(</span><span class="mi">255</span> <span class="o">*</span> <span class="n">cmap_array</span><span class="p">[(</span><span class="mi">255</span> <span class="o">*</span> <span class="p">(</span><span class="n">array</span> <span class="o">-</span> <span class="n">mi</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">ma</span> <span class="o">-</span> <span class="n">mi</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)],</span> <span class="n">smallsurf</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_get_screen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">isfull</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Internal function for generating pygame screen surface.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        isfull : bool, optional</span>
<span class="sd">            If set to True, the screen is initialized as full screen surface.</span>
<span class="sd">            Default value is False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_mode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">pygame</span><span class="o">.</span><span class="n">FULLSCREEN</span><span class="p">)</span> <span class="k">if</span> <span class="n">isfull</span> <span class="k">else</span> <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_mode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>

<div class="viewcode-block" id="Playground.blit_to_screen"><a class="viewcode-back" href="../../pgutil.html#pgutil.core.Playground.blit_to_screen">[docs]</a>    <span class="k">def</span> <span class="nf">blit_to_screen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;2次元配列を使用してウィンドウのピクセルデータを操作する.</span>

<span class="sd">        [0-255]の値を持つ整数配列を使用してウィンドウのピクセルデータを直接設定する.</span>
<span class="sd">        入力された配列はウィンドウのピクセルのRGBすべてに代入され、モノクロ画像として描画される.</span>
<span class="sd">        配列は自動的に伸縮されないため, 配列サイズとウィンドウサイズは一致している必要がある.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        array : array_like</span>
<span class="sd">            ウィンドウサイズ(Playground.size)と形状の等しい配列.</span>
<span class="sd">            2次元配列で, すべての値は0から255の範囲に入っている必要がある.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pygame</span><span class="o">.</span><span class="n">surfarray</span><span class="o">.</span><span class="n">pixels3d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="p">)[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="n">array</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">array</span><span class="p">))</span></div>

<div class="viewcode-block" id="Playground.blit_to_screen_3d"><a class="viewcode-back" href="../../pgutil.html#pgutil.core.Playground.blit_to_screen_3d">[docs]</a>    <span class="k">def</span> <span class="nf">blit_to_screen_3d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;3次元配列を使用してウィンドウのピクセルデータを操作する.</span>

<span class="sd">        [0-255]の値を持つ整数配列を使用してウィンドウのピクセルデータを直接設定する.</span>
<span class="sd">        入力された配列はウィンドウのピクセルのRGBそれぞれに代入され、カラー画像として描画される.</span>
<span class="sd">        配列は自動的に伸縮されないため, 配列サイズとウィンドウサイズは一致している必要がある.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        array : array_like</span>
<span class="sd">            ウィンドウサイズ(Playground.size)と1, 2次元目の要素数が等しい配列.</span>
<span class="sd">            3次元配列で, すべての値は0から255の範囲に入っている必要がある.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pygame</span><span class="o">.</span><span class="n">surfarray</span><span class="o">.</span><span class="n">pixels3d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">screen</span><span class="p">)[:]</span> <span class="o">=</span> <span class="n">array</span><span class="p">[:]</span></div></div>


<div class="viewcode-block" id="GLground"><a class="viewcode-back" href="../../pgutil.html#pgutil.core.GLground">[docs]</a><span class="k">class</span> <span class="nc">GLground</span><span class="p">(</span><span class="n">__PgBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;3次元データの可視化用のクラス.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    w_ : int, optional</span>
<span class="sd">        ウィンドウの幅,</span>
<span class="sd">        デフォルト値は500.</span>
<span class="sd">    h_ : int, optional</span>
<span class="sd">        ウィンドウの高さ,</span>
<span class="sd">        デフォルト値は500.</span>
<span class="sd">    name : str, optional</span>
<span class="sd">        ウィンドウのタイトル,</span>
<span class="sd">        デフォルト値は&quot;GLground&quot;.</span>
<span class="sd">    antialiasing : bool, optional</span>
<span class="sd">        アンチエイリアス処理を行うかどうか.</span>
<span class="sd">        デフォルト値はFalse.</span>
<span class="sd">    ortho : bool, optional</span>
<span class="sd">        正射影による描画を行うかどうか.</span>
<span class="sd">        デフォルト値はFalseで視点投影により描画される.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    ax : float</span>
<span class="sd">        x軸を軸としたカメラの回転角. 矢印キーで操作可能なほか直接代入することも可能.</span>
<span class="sd">    ay : float</span>
<span class="sd">        y軸を軸としたカメラの回転角. 矢印キーで操作可能なほか直接代入することも可能.</span>
<span class="sd">    az : float</span>
<span class="sd">        z軸を軸としたカメラの回転角.　矢印キーで操作可能なほか直接代入することも可能.</span>
<span class="sd">    lx : float</span>
<span class="sd">        カメラのx座標. shuft+矢印キーで操作可能なほか直接代入することも可能.</span>
<span class="sd">    ly : float</span>
<span class="sd">        カメラのy座標. shuft+矢印キーで操作可能なほか直接代入することも可能.</span>
<span class="sd">    lz : float</span>
<span class="sd">        カメラのz座標.　shuft+矢印キーで操作可能なほか直接代入することも可能.</span>
<span class="sd">    cube_flag : bool</span>
<span class="sd">        各軸の頂点の座標が+-1の立方体を描画するかどうか. デフォルトはTrue.</span>
<span class="sd">    rotating : bool</span>
<span class="sd">        描画範囲を自動回転させるかどうか. デフォルトはFalse.</span>
<span class="sd">    rot_vel : float</span>
<span class="sd">        描画範囲の自動回転の速度.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w_</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">h_</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;GLground&quot;</span><span class="p">,</span> <span class="n">antialiasing</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ortho</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">antialiasing</span> <span class="o">=</span> <span class="n">antialiasing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ortho</span> <span class="o">=</span> <span class="n">ortho</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">linewidth</span> <span class="o">=</span> <span class="mf">1.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pointsize</span> <span class="o">=</span> <span class="mf">1.</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">w_</span><span class="p">,</span> <span class="n">h_</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ay</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">az</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lx</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ly</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lz</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cube_flag</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rotating</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rot_vel</span> <span class="o">=</span> <span class="mf">1.0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mesh_cache</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">surf_cache</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text_cache</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">voxelcol</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">light_initialized</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cube_tex</span> <span class="o">=</span> <span class="n">glGenTextures</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">last_bind_func</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_screen_mode_func</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clear_tex_cache</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_screen_mode_func</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_reload_3d_tex</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_screen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">isfull</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Internal function for generating pygame screen surface.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        isfull : bool, optional</span>
<span class="sd">            If set to True, the screen is initialized as full screen surface.</span>
<span class="sd">            Default value is False.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">antialiasing</span><span class="p">:</span>
            <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">gl_set_attribute</span><span class="p">(</span><span class="n">GL_MULTISAMPLEBUFFERS</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">gl_set_attribute</span><span class="p">(</span><span class="n">GL_MULTISAMPLESAMPLES</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

        <span class="n">scr</span> <span class="o">=</span> <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_mode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
                                      <span class="n">pygame</span><span class="o">.</span><span class="n">FULLSCREEN</span> <span class="o">|</span> <span class="n">pygame</span><span class="o">.</span><span class="n">OPENGL</span> <span class="o">|</span> <span class="n">pygame</span><span class="o">.</span><span class="n">DOUBLEBUF</span><span class="p">)</span> <span class="k">if</span> <span class="n">isfull</span> <span class="k">else</span> <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_mode</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">pygame</span><span class="o">.</span><span class="n">OPENGL</span> <span class="o">|</span> <span class="n">pygame</span><span class="o">.</span><span class="n">DOUBLEBUF</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">antialiasing</span><span class="p">:</span>
            <span class="n">glEnable</span><span class="p">(</span><span class="n">GL_MULTISAMPLE</span><span class="p">)</span>
            <span class="n">glEnable</span><span class="p">(</span><span class="n">GL_SAMPLE_ALPHA_TO_COVERAGE</span><span class="p">)</span>
            <span class="n">glSampleCoverage</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">GL_FALSE</span><span class="p">)</span>

        <span class="n">glEnable</span><span class="p">(</span><span class="n">GL_ALPHA_TEST</span><span class="p">)</span>
        <span class="n">glEnable</span><span class="p">(</span><span class="n">GL_DEPTH_TEST</span><span class="p">)</span>
        <span class="n">glViewport</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
        <span class="n">glMatrixMode</span><span class="p">(</span><span class="n">GL_PROJECTION</span><span class="p">)</span>
        <span class="n">glLoadIdentity</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ortho</span><span class="p">:</span>
            <span class="n">limit</span> <span class="o">=</span> <span class="mf">1.5</span>
            <span class="n">ratio</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">ratio</span> <span class="o">&lt;</span> <span class="mf">1.</span><span class="p">:</span>
                <span class="n">glOrtho</span><span class="p">(</span><span class="o">-</span><span class="n">limit</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="o">-</span><span class="n">limit</span> <span class="o">/</span> <span class="n">ratio</span><span class="p">,</span> <span class="n">limit</span> <span class="o">/</span> <span class="n">ratio</span><span class="p">,</span> <span class="o">-</span><span class="mf">64.</span><span class="p">,</span> <span class="mf">64.</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">ratio</span> <span class="o">&gt;</span> <span class="mf">1.</span><span class="p">:</span>
                <span class="n">glOrtho</span><span class="p">(</span><span class="o">-</span><span class="n">limit</span> <span class="o">*</span> <span class="n">ratio</span><span class="p">,</span> <span class="n">limit</span> <span class="o">*</span> <span class="n">ratio</span><span class="p">,</span> <span class="o">-</span><span class="n">limit</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="o">-</span><span class="mf">64.</span><span class="p">,</span> <span class="mf">64.</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">glOrtho</span><span class="p">(</span><span class="o">-</span><span class="n">limit</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="o">-</span><span class="n">limit</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="o">-</span><span class="mf">64.</span><span class="p">,</span> <span class="mf">64.</span><span class="p">)</span>

            <span class="n">glMatrixMode</span><span class="p">(</span><span class="n">GL_MODELVIEW</span><span class="p">)</span>
            <span class="n">glLoadIdentity</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">gluPerspective</span><span class="p">(</span><span class="mf">60.0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">)</span>
            <span class="n">glMatrixMode</span><span class="p">(</span><span class="n">GL_MODELVIEW</span><span class="p">)</span>

        <span class="n">glBlendFunc</span><span class="p">(</span><span class="n">GL_SRC_ALPHA</span><span class="p">,</span> <span class="n">GL_ONE_MINUS_SRC_ALPHA</span><span class="p">)</span>
        <span class="n">glEnable</span><span class="p">(</span><span class="n">GL_BLEND</span><span class="p">)</span>

        <span class="n">glLineWidth</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">linewidth</span><span class="p">)</span>
        <span class="n">glPointSize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pointsize</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">scr</span>

    <span class="k">def</span> <span class="nf">_update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Internal function for updating pygame window.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">running</span><span class="p">:</span>
            <span class="n">pygame</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exit_flag</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">screenshot_flag</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">take_screenshot</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">screenshot_flag</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">clock</span><span class="o">.</span><span class="n">tick</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">glFlush</span><span class="p">()</span>
        <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">flip</span><span class="p">()</span>

        <span class="n">glClear</span><span class="p">(</span><span class="n">GL_COLOR_BUFFER_BIT</span> <span class="o">|</span> <span class="n">GL_DEPTH_BUFFER_BIT</span><span class="p">)</span>
        <span class="n">glLoadIdentity</span><span class="p">()</span>
        <span class="n">gluLookAt</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">glTranslated</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ly</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lz</span><span class="p">)</span>
        <span class="n">glRotated</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">glRotated</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ay</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">glRotated</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">az</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

        <span class="n">glClearColor</span><span class="p">(</span><span class="o">*</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">c</span> <span class="o">/</span> <span class="mf">255.</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">back_col</span><span class="p">)),</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cube_flag</span><span class="p">:</span>
            <span class="c1"># noinspection PyTypeChecker</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw_cube</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">c</span> <span class="o">/</span> <span class="mf">255.</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">)))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_flag</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw_axis</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ticking</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">totaltick</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_flag</span><span class="p">:</span>
            <span class="n">pygame</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">set_caption</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">+</span> <span class="s2">&quot;  fps : &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_fps</span><span class="p">()</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">debug_list</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_process_event</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Internal function for processing pygame events.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_process_event</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">pygame</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">get_pressed</span><span class="p">()[</span><span class="n">K_DOWN</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">pygame</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">get_pressed</span><span class="p">()[</span><span class="n">K_LSHIFT</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ly</span> <span class="o">-=</span> <span class="mf">0.01</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="o">+=</span> <span class="mf">2.0</span>
        <span class="k">if</span> <span class="n">pygame</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">get_pressed</span><span class="p">()[</span><span class="n">K_UP</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">pygame</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">get_pressed</span><span class="p">()[</span><span class="n">K_LSHIFT</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ly</span> <span class="o">+=</span> <span class="mf">0.01</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="o">-=</span> <span class="mf">2.0</span>
        <span class="k">if</span> <span class="n">pygame</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">get_pressed</span><span class="p">()[</span><span class="n">K_RIGHT</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">pygame</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">get_pressed</span><span class="p">()[</span><span class="n">K_LSHIFT</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lx</span> <span class="o">+=</span> <span class="mf">0.01</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ay</span> <span class="o">+=</span> <span class="mf">2.0</span>
        <span class="k">if</span> <span class="n">pygame</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">get_pressed</span><span class="p">()[</span><span class="n">K_LEFT</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">pygame</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">get_pressed</span><span class="p">()[</span><span class="n">K_LSHIFT</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lx</span> <span class="o">-=</span> <span class="mf">0.01</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ay</span> <span class="o">-=</span> <span class="mf">2.0</span>

        <span class="k">if</span> <span class="n">pygame</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">get_pressed</span><span class="p">()[</span><span class="n">K_PAGEUP</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lz</span> <span class="o">+=</span> <span class="mf">0.01</span>
        <span class="k">if</span> <span class="n">pygame</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">get_pressed</span><span class="p">()[</span><span class="n">K_PAGEDOWN</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lz</span> <span class="o">-=</span> <span class="mf">0.01</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ortho</span><span class="p">:</span>
            <span class="n">glMatrixMode</span><span class="p">(</span><span class="n">GL_PROJECTION</span><span class="p">)</span>
            <span class="n">glLoadIdentity</span><span class="p">()</span>
            <span class="n">limit</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">lz</span> <span class="o">+</span> <span class="mf">1.5</span>
            <span class="n">ratio</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">ratio</span> <span class="o">&lt;</span> <span class="mf">1.</span><span class="p">:</span>
                <span class="n">glOrtho</span><span class="p">(</span><span class="o">-</span><span class="n">limit</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="o">-</span><span class="n">limit</span> <span class="o">/</span> <span class="n">ratio</span><span class="p">,</span> <span class="n">limit</span> <span class="o">/</span> <span class="n">ratio</span><span class="p">,</span> <span class="o">-</span><span class="mf">64.</span><span class="p">,</span> <span class="mf">64.</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">ratio</span> <span class="o">&gt;</span> <span class="mf">1.</span><span class="p">:</span>
                <span class="n">glOrtho</span><span class="p">(</span><span class="o">-</span><span class="n">limit</span> <span class="o">*</span> <span class="n">ratio</span><span class="p">,</span> <span class="n">limit</span> <span class="o">*</span> <span class="n">ratio</span><span class="p">,</span> <span class="o">-</span><span class="n">limit</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="o">-</span><span class="mf">64.</span><span class="p">,</span> <span class="mf">64.</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">glOrtho</span><span class="p">(</span><span class="o">-</span><span class="n">limit</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="o">-</span><span class="n">limit</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="o">-</span><span class="mf">64.</span><span class="p">,</span> <span class="mf">64.</span><span class="p">)</span>
            <span class="n">glMatrixMode</span><span class="p">(</span><span class="n">GL_MODELVIEW</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotating</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">ticking</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ay</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rot_vel</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ay</span> <span class="o">%=</span> <span class="mi">360</span>

<div class="viewcode-block" id="GLground.set_line_width"><a class="viewcode-back" href="../../pgutil.html#pgutil.core.GLground.set_line_width">[docs]</a>    <span class="k">def</span> <span class="nf">set_line_width</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;描画される直線の太さを設定する.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        width : float</span>
<span class="sd">             描画に使用される直線の太さ.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linewidth</span> <span class="o">=</span> <span class="n">width</span>
        <span class="n">glLineWidth</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">linewidth</span><span class="p">)</span></div>

<div class="viewcode-block" id="GLground.set_point_size"><a class="viewcode-back" href="../../pgutil.html#pgutil.core.GLground.set_point_size">[docs]</a>    <span class="k">def</span> <span class="nf">set_point_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;描画される点の大きさを設定する.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        size : float</span>
<span class="sd">             描画に使用される点の大きさ.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pointsize</span> <span class="o">=</span> <span class="n">size</span>
        <span class="n">glPointSize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pointsize</span><span class="p">)</span></div>

<div class="viewcode-block" id="GLground.draw"><a class="viewcode-back" href="../../pgutil.html#pgutil.core.GLground.draw">[docs]</a>    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">GL_POINTS</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;頂点配列を指定した描画モードで描画する.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        points : allay_like</span>
<span class="sd">            頂点の座標を保持する2次元配列.</span>
<span class="sd">            2次元目の要素数は3である必要がある.</span>
<span class="sd">        mode : OpenGL.constant.IntConstant</span>
<span class="sd">            描画モードを表す定数.</span>
<span class="sd">            pgutil.GL_POINTS, pgutil.GL_LINES, pgutil.GL_LINE_STRIP,</span>
<span class="sd">            pgutil.TRIANGLES, pgutil.TRIANGLE_STRIP, pgutil.GL_QUADS</span>
<span class="sd">            や他のOpenGLの描画モードが使用可能.</span>
<span class="sd">            デフォルト値はpgutil.GL_POINTSで頂点を点として描画する.</span>
<span class="sd">        color : tuple of float, optional</span>
<span class="sd">            描画に使用される色.</span>
<span class="sd">            [0-1]の値を持つ要素数3または4のタプルが設定可能.</span>
<span class="sd">            指定がない場合はPlayground.colに保存された色が使用される.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">color</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">c</span> <span class="o">/</span> <span class="mf">255.</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">))</span>
        <span class="n">glEnableClientState</span><span class="p">(</span><span class="n">GL_VERTEX_ARRAY</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">color</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">glColor3dv</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">color</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">glColor4dv</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
        <span class="n">glVertexPointerf</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
        <span class="n">glDrawArrays</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">))</span></div>

<div class="viewcode-block" id="GLground.draw_with_color"><a class="viewcode-back" href="../../pgutil.html#pgutil.core.GLground.draw_with_color">[docs]</a>    <span class="k">def</span> <span class="nf">draw_with_color</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">colors</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;頂点配列を指定した描画モードで描画する.</span>

<span class="sd">        それぞれの頂点は異なる色で描画される.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        points : allay_like</span>
<span class="sd">            頂点の座標を保持する2次元配列.</span>
<span class="sd">            2次元目の要素数は3である必要がある.</span>
<span class="sd">        mode : OpenGL.constant.IntConstant</span>
<span class="sd">            描画モードを表す定数.</span>
<span class="sd">            pgutil.GL_POINTS, pgutil.GL_LINES, pgutil.GL_LINE_STRIP,</span>
<span class="sd">            pgutil.TRIANGLES, pgutil.TRIANGLE_STRIP, pgutil.GL_QUADS</span>
<span class="sd">            や他のOpenGLの描画モードが使用可能.</span>
<span class="sd">            デフォルト値はpgutil.GL_POINTSで頂点を点として描画する.</span>
<span class="sd">        colors : allay_like</span>
<span class="sd">            描画に使用する色の情報を格納した配列.</span>
<span class="sd">            1番目の次元の要素数はpointsに渡す配列と同じでなければならない.</span>
<span class="sd">            すべての値は[0-1]の範囲に入っている必要があり、2番目の次元の要素数は3または4でなければならない.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">glEnableClientState</span><span class="p">(</span><span class="n">GL_COLOR_ARRAY</span><span class="p">)</span>
        <span class="n">glEnableClientState</span><span class="p">(</span><span class="n">GL_VERTEX_ARRAY</span><span class="p">)</span>

        <span class="n">glColorPointerf</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span>
        <span class="n">glVertexPointerf</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
        <span class="n">glDrawArrays</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">))</span>

        <span class="n">glDisableClientState</span><span class="p">(</span><span class="n">GL_COLOR_ARRAY</span><span class="p">)</span>
        <span class="n">glDisableClientState</span><span class="p">(</span><span class="n">GL_VERTEX_ARRAY</span><span class="p">)</span></div>

<div class="viewcode-block" id="GLground.draw_with_norm"><a class="viewcode-back" href="../../pgutil.html#pgutil.core.GLground.draw_with_norm">[docs]</a>    <span class="k">def</span> <span class="nf">draw_with_norm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">norms</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;頂点配列を指定した描画モードで描画する.</span>

<span class="sd">        それぞれの頂点に法線ベクトルを設定することで陰影をつけて描画する.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        points : allay_like</span>
<span class="sd">            頂点の座標を保持する2次元配列.</span>
<span class="sd">            2次元目の要素数は3である必要がある.</span>
<span class="sd">        mode : OpenGL.constant.IntConstant</span>
<span class="sd">            描画モードを表す定数.</span>
<span class="sd">            pgutil.GL_POINTS, pgutil.GL_LINES, pgutil.GL_LINE_STRIP,</span>
<span class="sd">            pgutil.TRIANGLES, pgutil.TRIANGLE_STRIP, pgutil.GL_QUADS</span>
<span class="sd">            や他のOpenGLの描画モードが使用可能.</span>
<span class="sd">            デフォルト値はpgutil.GL_POINTSで頂点を点として描画する.</span>
<span class="sd">        norms : allay_like</span>
<span class="sd">            描画に使用する法線ベクトルを格納した配列.</span>
<span class="sd">            1番目の次元の要素数はpointsに渡す配列と同じで, 2番目の次元の要素数は3でなければならない.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">light_initialized</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_lighting</span><span class="p">()</span>

        <span class="n">glEnable</span><span class="p">(</span><span class="n">GL_LIGHT0</span><span class="p">)</span>
        <span class="n">glEnable</span><span class="p">(</span><span class="n">GL_NORMALIZE</span><span class="p">)</span>
        <span class="n">glEnable</span><span class="p">(</span><span class="n">GL_LIGHTING</span><span class="p">)</span>

        <span class="n">glEnableClientState</span><span class="p">(</span><span class="n">GL_NORMAL_ARRAY</span><span class="p">)</span>
        <span class="n">glEnableClientState</span><span class="p">(</span><span class="n">GL_VERTEX_ARRAY</span><span class="p">)</span>

        <span class="n">glNormalPointerf</span><span class="p">(</span><span class="n">norms</span><span class="p">)</span>
        <span class="n">glVertexPointerf</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
        <span class="n">glDrawArrays</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">))</span>

        <span class="n">glDisableClientState</span><span class="p">(</span><span class="n">GL_NORMAL_ARRAY</span><span class="p">)</span>
        <span class="n">glDisableClientState</span><span class="p">(</span><span class="n">GL_VERTEX_ARRAY</span><span class="p">)</span>

        <span class="n">glDisable</span><span class="p">(</span><span class="n">GL_LIGHT0</span><span class="p">)</span>
        <span class="n">glDisable</span><span class="p">(</span><span class="n">GL_NORMALIZE</span><span class="p">)</span>
        <span class="n">glDisable</span><span class="p">(</span><span class="n">GL_LIGHTING</span><span class="p">)</span></div>

<div class="viewcode-block" id="GLground.draw_with_tex"><a class="viewcode-back" href="../../pgutil.html#pgutil.core.GLground.draw_with_tex">[docs]</a>    <span class="k">def</span> <span class="nf">draw_with_tex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">texcords</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;頂点配列を指定した描画モードで描画する.</span>

<span class="sd">        それぞれの頂点にテクスチャ座標を指定することでポリゴンにテクスチャを貼り付けて描画する.</span>
<span class="sd">        テクスチャは事前にバインドしておく必要があり、使用できるテクスチャは2Dテクスチャのみ.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        points : allay_like</span>
<span class="sd">            頂点の座標を保持する2次元配列.</span>
<span class="sd">            2次元目の要素数は3である必要がある.</span>
<span class="sd">        mode : OpenGL.constant.IntConstant</span>
<span class="sd">            描画モードを表す定数.</span>
<span class="sd">            pgutil.GL_POINTS, pgutil.GL_LINES, pgutil.GL_LINE_STRIP,</span>
<span class="sd">            pgutil.TRIANGLES, pgutil.TRIANGLE_STRIP, pgutil.GL_QUADS</span>
<span class="sd">            や他のOpenGLの描画モードが使用可能.</span>
<span class="sd">            デフォルト値はpgutil.GL_POINTSで頂点を点として描画する.</span>
<span class="sd">        texcords : allay_like</span>
<span class="sd">            描画に使用するテクスチャ座標を格納した配列.</span>
<span class="sd">            すべての値は[0-1]の範囲に入っている必要があり、1番目の次元の要素数はpointsに渡す配列と同じで, 2番目の次元の要素数は2でなければならない.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">glEnable</span><span class="p">(</span><span class="n">GL_TEXTURE_2D</span><span class="p">)</span>
        <span class="n">glTexParameteri</span><span class="p">(</span><span class="n">GL_TEXTURE_2D</span><span class="p">,</span> <span class="n">GL_TEXTURE_MIN_FILTER</span><span class="p">,</span> <span class="n">GL_LINEAR</span><span class="p">)</span>
        <span class="n">glTexParameteri</span><span class="p">(</span><span class="n">GL_TEXTURE_2D</span><span class="p">,</span> <span class="n">GL_TEXTURE_MAG_FILTER</span><span class="p">,</span> <span class="n">GL_LINEAR</span><span class="p">)</span>

        <span class="n">glColor4dv</span><span class="p">((</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">))</span>

        <span class="n">glEnableClientState</span><span class="p">(</span><span class="n">GL_VERTEX_ARRAY</span><span class="p">)</span>
        <span class="n">glEnableClientState</span><span class="p">(</span><span class="n">GL_TEXTURE_COORD_ARRAY</span><span class="p">)</span>

        <span class="n">glVertexPointerf</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
        <span class="n">glTexCoordPointerf</span><span class="p">(</span><span class="n">texcords</span><span class="p">)</span>
        <span class="n">glDrawArrays</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">))</span>

        <span class="n">glDisableClientState</span><span class="p">(</span><span class="n">GL_VERTEX_ARRAY</span><span class="p">)</span>
        <span class="n">glDisableClientState</span><span class="p">(</span><span class="n">GL_TEXTURE_COORD_ARRAY</span><span class="p">)</span>

        <span class="n">glDisable</span><span class="p">(</span><span class="n">GL_TEXTURE_2D</span><span class="p">)</span></div>

<div class="viewcode-block" id="GLground.draw_with_tex_3d"><a class="viewcode-back" href="../../pgutil.html#pgutil.core.GLground.draw_with_tex_3d">[docs]</a>    <span class="k">def</span> <span class="nf">draw_with_tex_3d</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">texcords</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;頂点配列を指定した描画モードで描画する.</span>

<span class="sd">        それぞれの頂点にテクスチャ座標を指定することでポリゴンにテクスチャを貼り付けて描画する.</span>
<span class="sd">        テクスチャは事前にバインドしておく必要があり、使用できるテクスチャは3Dテクスチャのみ.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        points : allay_like</span>
<span class="sd">            頂点の座標を保持する2次元配列.</span>
<span class="sd">            2次元目の要素数は3である必要がある.</span>
<span class="sd">        mode : OpenGL.constant.IntConstant</span>
<span class="sd">            描画モードを表す定数.</span>
<span class="sd">            pgutil.GL_POINTS, pgutil.GL_LINES, pgutil.GL_LINE_STRIP,</span>
<span class="sd">            pgutil.TRIANGLES, pgutil.TRIANGLE_STRIP, pgutil.GL_QUADS</span>
<span class="sd">            や他のOpenGLの描画モードが使用可能.</span>
<span class="sd">            デフォルト値はpgutil.GL_POINTSで頂点を点として描画する.</span>
<span class="sd">        texcords : allay_like</span>
<span class="sd">            描画に使用するテクスチャ座標を格納した配列.</span>
<span class="sd">            すべての値は[0-1]の範囲に入っている必要があり、1番目の次元の要素数はpointsに渡す配列と同じで, 2番目の次元の要素数は3でなければならない.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">glEnable</span><span class="p">(</span><span class="n">GL_TEXTURE_3D</span><span class="p">)</span>
        <span class="n">glTexParameteri</span><span class="p">(</span><span class="n">GL_TEXTURE_3D</span><span class="p">,</span> <span class="n">GL_TEXTURE_MIN_FILTER</span><span class="p">,</span> <span class="n">GL_LINEAR</span><span class="p">)</span>
        <span class="n">glTexParameteri</span><span class="p">(</span><span class="n">GL_TEXTURE_3D</span><span class="p">,</span> <span class="n">GL_TEXTURE_MAG_FILTER</span><span class="p">,</span> <span class="n">GL_LINEAR</span><span class="p">)</span>
        <span class="n">glTexParameteri</span><span class="p">(</span><span class="n">GL_TEXTURE_3D</span><span class="p">,</span> <span class="n">GL_TEXTURE_WRAP_S</span><span class="p">,</span> <span class="n">GL_CLAMP_TO_EDGE</span><span class="p">)</span>
        <span class="n">glTexParameteri</span><span class="p">(</span><span class="n">GL_TEXTURE_3D</span><span class="p">,</span> <span class="n">GL_TEXTURE_WRAP_T</span><span class="p">,</span> <span class="n">GL_CLAMP_TO_EDGE</span><span class="p">)</span>
        <span class="n">glTexParameteri</span><span class="p">(</span><span class="n">GL_TEXTURE_3D</span><span class="p">,</span> <span class="n">GL_TEXTURE_WRAP_R</span><span class="p">,</span> <span class="n">GL_CLAMP_TO_EDGE</span><span class="p">)</span>

        <span class="n">glColor4dv</span><span class="p">((</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">))</span>

        <span class="n">glEnableClientState</span><span class="p">(</span><span class="n">GL_VERTEX_ARRAY</span><span class="p">)</span>
        <span class="n">glEnableClientState</span><span class="p">(</span><span class="n">GL_TEXTURE_COORD_ARRAY</span><span class="p">)</span>

        <span class="n">glVertexPointerf</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
        <span class="n">glTexCoordPointerf</span><span class="p">(</span><span class="n">texcords</span><span class="p">)</span>
        <span class="n">glDrawArrays</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">))</span>

        <span class="n">glDisableClientState</span><span class="p">(</span><span class="n">GL_VERTEX_ARRAY</span><span class="p">)</span>
        <span class="n">glDisableClientState</span><span class="p">(</span><span class="n">GL_TEXTURE_COORD_ARRAY</span><span class="p">)</span>

        <span class="n">glDisable</span><span class="p">(</span><span class="n">GL_TEXTURE_3D</span><span class="p">)</span></div>

<div class="viewcode-block" id="GLground.draw_text"><a class="viewcode-back" href="../../pgutil.html#pgutil.core.GLground.draw_text">[docs]</a>    <span class="k">def</span> <span class="nf">draw_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">scl</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">rotated</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;指定の位置にテキストを描画する.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        text : str</span>
<span class="sd">            描画するテキスト.</span>
<span class="sd">            改行も反映される.</span>
<span class="sd">        center : tuple of float</span>
<span class="sd">            テキストを描画する座標.</span>
<span class="sd">            要素数3のタプルによって指定する.</span>
<span class="sd">        scl : float</span>
<span class="sd">            表示の際のスケール.</span>
<span class="sd">            大きくするほどテキストが大きく表示される.</span>
<span class="sd">            デフォルト値は0.3</span>
<span class="sd">        rotated : bool</span>
<span class="sd">            90°回転するかどうか.</span>
<span class="sd">            デフォルトはFalse.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">text</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_cache</span><span class="p">:</span>
            <span class="n">tex_num</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_cache</span><span class="p">[</span><span class="n">text</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tex_num</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="n">_load_texture</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">text_cache</span><span class="p">[</span><span class="n">text</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">tex_num</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>

        <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span> <span class="o">*</span> <span class="n">scl</span>
        <span class="n">coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*=</span> <span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.16</span>
        <span class="n">texcoords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]])</span>

        <span class="n">glBindTexture</span><span class="p">(</span><span class="n">GL_TEXTURE_2D</span><span class="p">,</span> <span class="n">tex_num</span><span class="p">)</span>
        <span class="n">glDepthMask</span><span class="p">(</span><span class="n">GL_FALSE</span><span class="p">)</span>

        <span class="n">glPushMatrix</span><span class="p">()</span>
        <span class="n">glTranslated</span><span class="p">(</span><span class="n">center</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">center</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">center</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">glRotated</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">ay</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">glRotated</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rotated</span><span class="p">:</span> <span class="n">glRotated</span><span class="p">(</span><span class="mf">90.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)</span>
        <span class="n">glTranslated</span><span class="p">(</span><span class="o">-</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">scl</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="n">scl</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_with_tex</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">GL_QUADS</span><span class="p">,</span> <span class="n">texcoords</span><span class="p">)</span>
        <span class="n">glPopMatrix</span><span class="p">()</span>

        <span class="n">glDepthMask</span><span class="p">(</span><span class="n">GL_TRUE</span><span class="p">)</span></div>

<div class="viewcode-block" id="GLground.draw_cube"><a class="viewcode-back" href="../../pgutil.html#pgutil.core.GLground.draw_cube">[docs]</a>    <span class="k">def</span> <span class="nf">draw_cube</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;それぞれの辺がx, y, z軸に廃校した立方体を描画する.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        l : float</span>
<span class="sd">            描画する立方体の1辺の長さの1/2.</span>
<span class="sd">            最終的に描画される立方体の1辺の長さは2lとなる.</span>
<span class="sd">        color : tuple of float, optional</span>
<span class="sd">            描画に使用される色.</span>
<span class="sd">            [0-1]の値を持つ要素数3または4のタプルが設定可能.</span>
<span class="sd">            指定がない場合はPlayground.colに保存された色が使用される.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">color</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">c</span> <span class="o">/</span> <span class="mf">255.</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">col</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">(((</span><span class="o">-</span><span class="n">l</span><span class="p">,</span> <span class="o">-</span><span class="n">l</span><span class="p">,</span> <span class="o">-</span><span class="n">l</span><span class="p">),</span> <span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="o">-</span><span class="n">l</span><span class="p">,</span> <span class="o">-</span><span class="n">l</span><span class="p">),</span> <span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="o">-</span><span class="n">l</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">l</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="o">-</span><span class="n">l</span><span class="p">)),</span> <span class="n">GL_LINE_LOOP</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">(((</span><span class="o">-</span><span class="n">l</span><span class="p">,</span> <span class="o">-</span><span class="n">l</span><span class="p">,</span> <span class="n">l</span><span class="p">),</span> <span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="o">-</span><span class="n">l</span><span class="p">,</span> <span class="n">l</span><span class="p">),</span> <span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">l</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">l</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">l</span><span class="p">)),</span> <span class="n">GL_LINE_LOOP</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">(((</span><span class="o">-</span><span class="n">l</span><span class="p">,</span> <span class="o">-</span><span class="n">l</span><span class="p">,</span> <span class="o">-</span><span class="n">l</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">l</span><span class="p">,</span> <span class="o">-</span><span class="n">l</span><span class="p">,</span> <span class="n">l</span><span class="p">),</span> <span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="o">-</span><span class="n">l</span><span class="p">,</span> <span class="o">-</span><span class="n">l</span><span class="p">),</span> <span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="o">-</span><span class="n">l</span><span class="p">,</span> <span class="n">l</span><span class="p">),</span> <span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="o">-</span><span class="n">l</span><span class="p">),</span> <span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">l</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">l</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="o">-</span><span class="n">l</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">l</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">l</span><span class="p">)),</span>
                  <span class="n">GL_LINES</span><span class="p">,</span>
                  <span class="n">color</span><span class="p">)</span></div>

<div class="viewcode-block" id="GLground.draw_axis"><a class="viewcode-back" href="../../pgutil.html#pgutil.core.GLground.draw_axis">[docs]</a>    <span class="k">def</span> <span class="nf">draw_axis</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;x, y, z軸に廃校したRGB3色の直線を描画する.</span>

<span class="sd">        デバッグ時の座標の確認用.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">d</span> <span class="o">=</span> <span class="mf">1.1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_with_color</span><span class="p">(((</span><span class="o">-</span><span class="n">d</span><span class="p">,</span> <span class="o">-</span><span class="n">d</span><span class="p">,</span> <span class="o">-</span><span class="n">d</span><span class="p">),</span> <span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="o">-</span><span class="n">d</span><span class="p">,</span> <span class="o">-</span><span class="n">d</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">d</span><span class="p">,</span> <span class="o">-</span><span class="n">d</span><span class="p">,</span> <span class="o">-</span><span class="n">d</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">d</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="o">-</span><span class="n">d</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">d</span><span class="p">,</span> <span class="o">-</span><span class="n">d</span><span class="p">,</span> <span class="o">-</span><span class="n">d</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="n">d</span><span class="p">,</span> <span class="o">-</span><span class="n">d</span><span class="p">,</span> <span class="n">d</span><span class="p">)),</span>
                             <span class="n">GL_LINES</span><span class="p">,</span>
                             <span class="p">((</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)))</span></div>

<div class="viewcode-block" id="GLground.gen_voxel_data"><a class="viewcode-back" href="../../pgutil.html#pgutil.core.GLground.gen_voxel_data">[docs]</a>    <span class="k">def</span> <span class="nf">gen_voxel_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;3次元配列をボクセルデータとして描画するためのデータを生成する.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        array : allay_like</span>
<span class="sd">            ボクセルデータが格納されたnp.bool型の3次元配列.</span>
<span class="sd">            Trueに対応する場所が不透明であるとして描画される.</span>
<span class="sd">        colors : array_like</span>
<span class="sd">            描画に使用する色の情報を含んだ配列.</span>
<span class="sd">            1次元目の要素数は3または6, 2次元目の要素数は3または4である必要がある.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        verts : allay_like</span>
<span class="sd">            生成されたボクセルの頂点の座標が格納された配列.</span>
<span class="sd">            GLground.draw_with_color(verts, pgutil.GL_QUADS, cols)のようにして描画に使用できる.</span>
<span class="sd">        cols : allay_like</span>
<span class="sd">            生成されたボクセルの色の情報が格納された配列.</span>
<span class="sd">            GLground.draw_with_color(verts, pgutil.GL_QUADS, cols)のようにして描画に使用できる.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="n">_get_edges</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
        <span class="n">verts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span>

        <span class="n">col</span> <span class="o">=</span> <span class="n">colors</span> <span class="k">if</span> <span class="n">colors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">voxelcol</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="n">i</span><span class="o">//</span><span class="mi">2</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="o">==</span><span class="mi">3</span> <span class="k">else</span> <span class="n">col</span><span class="p">[</span><span class="n">i</span><span class="p">],(</span><span class="n">edges</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)])</span>
        <span class="k">return</span> <span class="n">verts</span><span class="p">,</span> <span class="n">cols</span></div>


<div class="viewcode-block" id="GLground.draw_voxel"><a class="viewcode-back" href="../../pgutil.html#pgutil.core.GLground.draw_voxel">[docs]</a>    <span class="k">def</span> <span class="nf">draw_voxel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;3次元配列をボクセルデータとして描画する.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        array : allay_like</span>
<span class="sd">            ボクセルデータが格納されたnp.bool型の3次元配列.</span>
<span class="sd">            Trueに対応する場所が不透明であるとして描画される.</span>
<span class="sd">        colors : array_like</span>
<span class="sd">            描画に使用する色の情報を含んだ配列.</span>
<span class="sd">            1次元目の要素数は3または6, 2次元目の要素数は3または4である必要がある.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">verts</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gen_voxel_data</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">colors</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_with_color</span><span class="p">(</span><span class="n">verts</span><span class="p">,</span> <span class="n">GL_QUADS</span><span class="p">,</span> <span class="n">cols</span><span class="p">)</span></div>

<div class="viewcode-block" id="GLground.gen_meshdata"><a class="viewcode-back" href="../../pgutil.html#pgutil.core.GLground.gen_meshdata">[docs]</a>    <span class="k">def</span> <span class="nf">gen_meshdata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">minin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">maxin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scl</span><span class="o">=</span><span class="mf">1.</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;2次元配列をメッシュデータとして描画するためのデータを生成する.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        array : array_like</span>
<span class="sd">            メッシュとして描画する対象となるデータを格納した2次元配列.</span>
<span class="sd">            2次元配列でなおかつ1次元目と2次元目の要素数が一致している必要がある.</span>
<span class="sd">        minin : float, optional</span>
<span class="sd">            表示の際に最小として表示される値.</span>
<span class="sd">            これより小さい値は黒として表示される.</span>
<span class="sd">            指定がない場合は入力された配列の最小値が使用される.</span>
<span class="sd">        maxin : float, optional</span>
<span class="sd">            表示の際に最大として表示される値.</span>
<span class="sd">            これより大きい値はPlayground.colと同じ色で表示される.</span>
<span class="sd">            指定がない場合は入力された配列の最大値が使用される.</span>
<span class="sd">        scl : float, optional</span>
<span class="sd">            高さ方向のスケールを決定する定数.</span>
<span class="sd">            指定がない場合は1が使用され、最大、最小の高さがそれぞれ1, -1になるよう描画される.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        mesh : allay_like</span>
<span class="sd">            生成されたメッシュの頂点の座標が格納された配列.</span>
<span class="sd">            GLground.draw(mesh, pgutil.GL_LINE_STRIP)のようにして描画に使用できる.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">minin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">maxin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">minin</span><span class="p">,</span> <span class="n">maxin</span><span class="p">)</span>

        <span class="n">ma</span> <span class="o">=</span> <span class="n">maxin</span> <span class="k">if</span> <span class="n">maxin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">array</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">mi</span> <span class="o">=</span> <span class="n">minin</span> <span class="k">if</span> <span class="n">minin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">array</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>

        <span class="n">temp</span> <span class="o">=</span> <span class="p">((</span><span class="n">array</span> <span class="o">-</span> <span class="n">mi</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">ma</span> <span class="o">-</span> <span class="n">mi</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span> <span class="o">-</span> <span class="mf">1.</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_cache</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mesh_cache</span><span class="p">[</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">]</span> <span class="o">=</span> <span class="n">_gen_mesh_index</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

        <span class="n">mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_cache</span><span class="p">[</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">]</span>

        <span class="n">mesh</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">temp</span> <span class="o">*</span> <span class="n">scl</span>
        <span class="k">return</span> <span class="n">mesh</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">mesh</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span></div>

<div class="viewcode-block" id="GLground.draw_mesh"><a class="viewcode-back" href="../../pgutil.html#pgutil.core.GLground.draw_mesh">[docs]</a>    <span class="k">def</span> <span class="nf">draw_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">minin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">maxin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scl</span><span class="o">=</span><span class="mf">1.</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;2次元配列をメッシュデータとして描画する.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        array : array_like</span>
<span class="sd">            メッシュとして描画する対象となるデータを格納した2次元配列.</span>
<span class="sd">            2次元配列でなおかつ1次元目と2次元目の要素数が一致している必要がある.</span>
<span class="sd">        minin : float, optional</span>
<span class="sd">            表示の際に最小として表示される値.</span>
<span class="sd">            これより小さい値は黒として表示される.</span>
<span class="sd">            指定がない場合は入力された配列の最小値が使用される.</span>
<span class="sd">        maxin : float, optional</span>
<span class="sd">            表示の際に最大として表示される値.</span>
<span class="sd">            これより大きい値はPlayground.colと同じ色で表示される.</span>
<span class="sd">            指定がない場合は入力された配列の最大値が使用される.</span>
<span class="sd">        scl : float, optional</span>
<span class="sd">            高さ方向のスケールを決定する定数.</span>
<span class="sd">            指定がない場合は1が使用され、最大、最小の高さがそれぞれ1, -1になるよう描画される.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gen_meshdata</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">minin</span><span class="p">,</span> <span class="n">maxin</span><span class="p">,</span> <span class="n">scl</span><span class="p">),</span> <span class="n">GL_LINE_STRIP</span><span class="p">)</span></div>

<div class="viewcode-block" id="GLground.gen_meshdata_colored"><a class="viewcode-back" href="../../pgutil.html#pgutil.core.GLground.gen_meshdata_colored">[docs]</a>    <span class="k">def</span> <span class="nf">gen_meshdata_colored</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">minin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">maxin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gist_rainbow_r&quot;</span><span class="p">,</span> <span class="n">scl</span><span class="o">=</span><span class="mf">1.</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;2次元配列を色付きのメッシュデータとして描画するためのデータを生成する.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        array : array_like</span>
<span class="sd">            メッシュとして描画する対象となるデータを格納した2次元配列.</span>
<span class="sd">            2次元配列でなおかつ1次元目と2次元目の要素数が一致している必要がある.</span>
<span class="sd">        minin : float, optional</span>
<span class="sd">            表示の際に最小として表示される値.</span>
<span class="sd">            これより小さい値は黒として表示される.</span>
<span class="sd">            指定がない場合は入力された配列の最小値が使用される.</span>
<span class="sd">        maxin : float, optional</span>
<span class="sd">            表示の際に最大として表示される値.</span>
<span class="sd">            これより大きい値はPlayground.colと同じ色で表示される.</span>
<span class="sd">            指定がない場合は入力された配列の最大値が使用される.</span>
<span class="sd">        cmap : str</span>
<span class="sd">            描画に使用されるカラーマップ.</span>
<span class="sd">            matplotlibで使用可能なカラーマップ全てと&quot;AVS&quot;, &quot;AVS_r&quot;が使用可能.</span>
<span class="sd">            指定がない場合は&quot;gist_rainbow_r&quot;が選択される.</span>
<span class="sd">        scl : float, optional</span>
<span class="sd">            高さ方向のスケールを決定する定数.</span>
<span class="sd">            指定がない場合は1が使用され、最大、最小の高さがそれぞれ1, -1になるよう描画される.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        mesh : allay_like</span>
<span class="sd">            生成されたメッシュの頂点の座標が格納された配列.</span>
<span class="sd">            GLground.draw_with_color(mesh, pgutil.GL_LINE_STRIP, color)のようにして描画に使用できる.</span>
<span class="sd">        color : allay_like</span>
<span class="sd">            生成されたメッシュの色の情報が格納された配列.</span>
<span class="sd">            GLground.draw_with_color(mesh, pgutil.GL_LINE_STRIP, color)のようにして描画に使用できる.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">minin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">maxin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">minin</span><span class="p">,</span> <span class="n">maxin</span><span class="p">)</span>

        <span class="n">ma</span> <span class="o">=</span> <span class="n">maxin</span> <span class="k">if</span> <span class="n">maxin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">array</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">mi</span> <span class="o">=</span> <span class="n">minin</span> <span class="k">if</span> <span class="n">minin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">array</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>

        <span class="n">temp</span> <span class="o">=</span> <span class="p">((</span><span class="n">array</span> <span class="o">-</span> <span class="n">mi</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">ma</span> <span class="o">-</span> <span class="n">mi</span><span class="p">)))</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

        <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="p">)[(</span><span class="n">temp</span> <span class="o">*</span> <span class="mi">255</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_cache</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Illegal array shape.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mesh_cache</span><span class="p">[</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">]</span> <span class="o">=</span> <span class="n">_gen_mesh_index</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

        <span class="n">mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_cache</span><span class="p">[</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">]</span>

        <span class="n">mesh</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">(</span><span class="n">temp</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">scl</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mesh</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">mesh</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">color</span><span class="p">[</span><span class="n">mesh</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span></div>

<div class="viewcode-block" id="GLground.draw_mesh_colored"><a class="viewcode-back" href="../../pgutil.html#pgutil.core.GLground.draw_mesh_colored">[docs]</a>    <span class="k">def</span> <span class="nf">draw_mesh_colored</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">minin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">maxin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gist_rainbow_r&quot;</span><span class="p">,</span> <span class="n">scl</span><span class="o">=</span><span class="mf">1.</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;2次元配列を色付きのメッシュデータとして描画する.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        array : array_like</span>
<span class="sd">            メッシュとして描画する対象となるデータを格納した2次元配列.</span>
<span class="sd">            2次元配列でなおかつ1次元目と2次元目の要素数が一致している必要がある.</span>
<span class="sd">        minin : float, optional</span>
<span class="sd">            表示の際に最小として表示される値.</span>
<span class="sd">            これより小さい値は黒として表示される.</span>
<span class="sd">            指定がない場合は入力された配列の最小値が使用される.</span>
<span class="sd">        maxin : float, optional</span>
<span class="sd">            表示の際に最大として表示される値.</span>
<span class="sd">            これより大きい値はPlayground.colと同じ色で表示される.</span>
<span class="sd">            指定がない場合は入力された配列の最大値が使用される.</span>
<span class="sd">        cmap : str</span>
<span class="sd">            描画に使用されるカラーマップ.</span>
<span class="sd">            matplotlibで使用可能なカラーマップ全てと&quot;AVS&quot;, &quot;AVS_r&quot;が使用可能.</span>
<span class="sd">            指定がない場合は&quot;gist_rainbow_r&quot;が選択される.</span>
<span class="sd">        scl : float, optional</span>
<span class="sd">            高さ方向のスケールを決定する定数.</span>
<span class="sd">            指定がない場合は1が使用され、最大、最小の高さがそれぞれ1, -1になるよう描画される.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">mesh</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gen_meshdata_colored</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">minin</span><span class="p">,</span> <span class="n">maxin</span><span class="p">,</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">scl</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_with_color</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">GL_LINE_STRIP</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span></div>

<div class="viewcode-block" id="GLground.gen_surfdata"><a class="viewcode-back" href="../../pgutil.html#pgutil.core.GLground.gen_surfdata">[docs]</a>    <span class="k">def</span> <span class="nf">gen_surfdata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">minin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">maxin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scl</span><span class="o">=</span><span class="mf">1.</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;2次元配列を陰影が処理された曲面として描画するためのデータを生成する.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        array : array_like</span>
<span class="sd">            曲面として描画する対象となるデータを格納した2次元配列.</span>
<span class="sd">            2次元配列でなおかつ1次元目と2次元目の要素数が一致している必要がある.</span>
<span class="sd">        minin : float, optional</span>
<span class="sd">            表示の際に最小として表示される値.</span>
<span class="sd">            これより小さい値は黒として表示される.</span>
<span class="sd">            指定がない場合は入力された配列の最小値が使用される.</span>
<span class="sd">        maxin : float, optional</span>
<span class="sd">            表示の際に最大として表示される値.</span>
<span class="sd">            これより大きい値はPlayground.colと同じ色で表示される.</span>
<span class="sd">            指定がない場合は入力された配列の最大値が使用される.</span>
<span class="sd">        scl : float, optional</span>
<span class="sd">            高さ方向のスケールを決定する定数.</span>
<span class="sd">            指定がない場合は1が使用され、最大、最小の高さがそれぞれ1, -1になるよう描画される.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        surf : allay_like</span>
<span class="sd">            生成された曲面の頂点の座標が格納された配列.</span>
<span class="sd">            GLground.draw_with_norm(surf, pgutil.GL_TRIANGLE_STRIP, norm)のようにして描画に使用できる.</span>
<span class="sd">        norms : allay_like</span>
<span class="sd">            生成された曲面の法線ベクトルが格納された配列.</span>
<span class="sd">            GLground.draw_with_norm(surf, pgutil.GL_TRIANGLE_STRIP, norm)のようにして描画に使用できる.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">minin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">maxin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">minin</span><span class="p">,</span> <span class="n">maxin</span><span class="p">)</span>

        <span class="n">ma</span> <span class="o">=</span> <span class="n">maxin</span> <span class="k">if</span> <span class="n">maxin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">array</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">mi</span> <span class="o">=</span> <span class="n">minin</span> <span class="k">if</span> <span class="n">minin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">array</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>

        <span class="n">temp</span> <span class="o">=</span> <span class="p">((</span><span class="n">array</span> <span class="o">-</span> <span class="n">mi</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">ma</span> <span class="o">-</span> <span class="n">mi</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">scl</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.</span> <span class="o">*</span> <span class="n">scl</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">surf_cache</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Illegal array shape.&quot;</span><span class="p">)</span>
            <span class="n">drawing</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(((</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
            <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">drawing</span><span class="p">[::</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">xx</span><span class="o">.</span><span class="n">ravel</span><span class="p">()[:</span><span class="o">-</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">drawing</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">xx</span><span class="o">.</span><span class="n">ravel</span><span class="p">()[</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:]</span>
            <span class="n">drawing</span><span class="p">[::</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">yy</span><span class="o">.</span><span class="n">ravel</span><span class="p">()[:</span><span class="o">-</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">drawing</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">yy</span><span class="o">.</span><span class="n">ravel</span><span class="p">()[</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:]</span>
            <span class="n">drawing</span><span class="p">[::</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="n">norms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">drawing</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">surf_cache</span><span class="p">[</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">drawing</span><span class="p">,</span> <span class="n">norms</span><span class="p">)</span>

        <span class="n">surf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">surf_cache</span><span class="p">[</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">surf</span><span class="p">[::</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp</span><span class="p">[:</span><span class="o">-</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">surf</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp</span><span class="p">[</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:]</span>

        <span class="n">norms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">surf_cache</span><span class="p">[</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">norms</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">surf</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">surf</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span> <span class="n">surf</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">surf</span><span class="p">[</span><span class="mi">2</span><span class="p">:,</span> <span class="p">:])</span>
        <span class="n">norms</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="k">return</span> <span class="n">surf</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">norms</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span></div>

<div class="viewcode-block" id="GLground.draw_surface"><a class="viewcode-back" href="../../pgutil.html#pgutil.core.GLground.draw_surface">[docs]</a>    <span class="k">def</span> <span class="nf">draw_surface</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">minin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">maxin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scl</span><span class="o">=</span><span class="mf">1.</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;2次元配列を陰影が処理された曲面として描画する.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        array : array_like</span>
<span class="sd">            曲面として描画する対象となるデータを格納した2次元配列.</span>
<span class="sd">            2次元配列でなおかつ1次元目と2次元目の要素数が一致している必要がある.</span>
<span class="sd">        minin : float, optional</span>
<span class="sd">            表示の際に最小として表示される値.</span>
<span class="sd">            これより小さい値は黒として表示される.</span>
<span class="sd">            指定がない場合は入力された配列の最小値が使用される.</span>
<span class="sd">        maxin : float, optional</span>
<span class="sd">            表示の際に最大として表示される値.</span>
<span class="sd">            これより大きい値はPlayground.colと同じ色で表示される.</span>
<span class="sd">            指定がない場合は入力された配列の最大値が使用される.</span>
<span class="sd">        scl : float, optional</span>
<span class="sd">            高さ方向のスケールを決定する定数.</span>
<span class="sd">            指定がない場合は1が使用され、最大、最小の高さがそれぞれ1, -1になるよう描画される.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">surf</span><span class="p">,</span> <span class="n">norm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gen_surfdata</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">minin</span><span class="p">,</span> <span class="n">maxin</span><span class="p">,</span> <span class="n">scl</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_with_norm</span><span class="p">(</span><span class="n">surf</span><span class="p">,</span> <span class="n">GL_TRIANGLE_STRIP</span><span class="p">,</span> <span class="n">norm</span><span class="p">)</span></div>

<div class="viewcode-block" id="GLground.gen_marching_data"><a class="viewcode-back" href="../../pgutil.html#pgutil.core.GLground.gen_marching_data">[docs]</a>    <span class="k">def</span> <span class="nf">gen_marching_data</span><span class="p">(</span><span class="n">selfarray</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">thresh</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;マーチングキューブ法を用いて3次元配列の等値面をを滑らかな立体として描画するためのデータを生成する.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        array : array_like</span>
<span class="sd">            立体として描画するデータを格納した3次元配列.</span>
<span class="sd">        thresh : float</span>
<span class="sd">            描画する曲面での配列中での値.</span>
<span class="sd">        reverse : bool, optional</span>
<span class="sd">            不透明であるとして描画する範囲を反転させるかどうか.</span>
<span class="sd">            Falseの場合, threshに指定された値より大きい値を持つ場所が不透明であるとして描画される.</span>
<span class="sd">            Trueの場合, threshに指定された値より小さい値を持つ場所が不透明であるとして描画される.</span>
<span class="sd">            デフォルト値はFalse.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        surf : allay_like</span>
<span class="sd">            生成された曲面の頂点の座標が格納された配列.</span>
<span class="sd">            GLground.draw_with_norm(surf, pgutil.GL_TRIANGLE_STRIP, norm)のようにして描画に使用できる.</span>
<span class="sd">        norms : allay_like</span>
<span class="sd">            生成された曲面の法線ベクトルが格納された配列.</span>
<span class="sd">            GLground.draw_with_norm(surf, pgutil.GL_TRIANGLE_STRIP, norm)のようにして描画に使用できる.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">width_half</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">verts</span><span class="p">,</span> <span class="n">faces</span><span class="p">,</span> <span class="n">normals</span><span class="p">,</span> <span class="n">values</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">marching_cubes_lewiner</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">thresh</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">RuntimeError</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

        <span class="n">new_norm</span> <span class="o">=</span> <span class="o">-</span><span class="n">normals</span><span class="p">[</span><span class="n">faces</span><span class="p">]</span> <span class="k">if</span> <span class="n">reverse</span> <span class="k">else</span> <span class="n">normals</span><span class="p">[</span><span class="n">faces</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">(((</span><span class="n">verts</span><span class="p">[</span><span class="n">faces</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">width_half</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">width_half</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">faces</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">new_norm</span></div>

<div class="viewcode-block" id="GLground.draw_marching_cubes"><a class="viewcode-back" href="../../pgutil.html#pgutil.core.GLground.draw_marching_cubes">[docs]</a>    <span class="k">def</span> <span class="nf">draw_marching_cubes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">thresh</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;マーチングキューブ法を用いて3次元配列の等値面をを滑らかな立体として描画する.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        array : array_like</span>
<span class="sd">            立体として描画するデータを格納した3次元配列.</span>
<span class="sd">        thresh : float</span>
<span class="sd">            描画する曲面での配列中での値.</span>
<span class="sd">        reverse : bool, optional</span>
<span class="sd">            不透明であるとして描画する範囲を反転させるかどうか.</span>
<span class="sd">            Falseの場合, threshに指定された値より大きい値を持つ場所が不透明であるとして描画される.</span>
<span class="sd">            Trueの場合, threshに指定された値より小さい値を持つ場所が不透明であるとして描画される.</span>
<span class="sd">            デフォルト値はFalse.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">surf</span><span class="p">,</span> <span class="n">norm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gen_marching_data</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">thresh</span><span class="p">,</span> <span class="n">reverse</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">surf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">norm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw_with_norm</span><span class="p">(</span><span class="n">surf</span><span class="p">,</span> <span class="n">GL_TRIANGLES</span><span class="p">,</span> <span class="n">norm</span><span class="p">)</span></div>

<div class="viewcode-block" id="GLground.bind_tex_cube"><a class="viewcode-back" href="../../pgutil.html#pgutil.core.GLground.bind_tex_cube">[docs]</a>    <span class="k">def</span> <span class="nf">bind_tex_cube</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">minin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">maxin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;3Dテクスチャを用いて3次元配列を模様付きの立方体として描画するためのテクスチャをバインドする.</span>

<span class="sd">        この関数を1度呼び出してからGLground.draw_tex_cubeをarrayの引数を指定無しで呼び出すことで内容の変化しない3次元配列を光速に描画可能.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        array : array_like</span>
<span class="sd">            描画するデータを格納した3次元配列もしくは4次元配列.</span>
<span class="sd">            3次元配列の場合任意の値を持った配列で, 値に応じた色がカラーマップから選ばれて描画される.</span>
<span class="sd">            4次元配列の場合は4次元目がRGBの順番で色の情報を格納した配列であるとみなす. この場合, 配列の値は[0-1]の範囲に入っている必要がある.</span>
<span class="sd">        minin : float, optional</span>
<span class="sd">            表示の際に最小として表示される値.</span>
<span class="sd">            これより小さい値は黒として表示される.</span>
<span class="sd">            指定がない場合は入力された配列の最小値が使用される.</span>
<span class="sd">            arrayに渡された配列の次元数が4の場合は無視される.</span>
<span class="sd">        maxin : float, optional</span>
<span class="sd">            表示の際に最大として表示される値.</span>
<span class="sd">            これより大きい値はPlayground.colと同じ色で表示される.</span>
<span class="sd">            指定がない場合は入力された配列の最大値が使用される.</span>
<span class="sd">            arrayに渡された配列の次元数が4の場合は無視される.</span>
<span class="sd">        cmap : str, optional</span>
<span class="sd">            描画に使用されるカラーマップ.</span>
<span class="sd">            matplotlibで使用可能なカラーマップ全てと&quot;AVS&quot;, &quot;AVS_r&quot;が使用可能.</span>
<span class="sd">            指定がない場合は&quot;vivid&quot;が選択される.</span>
<span class="sd">            arrayに渡された配列の次元数が4の場合は無視される.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        color : allay_like</span>
<span class="sd">            生成された色情報を格納した4次元配列.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">last_bind_func</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">bind_tex_cube</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">minin</span><span class="p">,</span> <span class="n">maxin</span><span class="p">,</span> <span class="n">cmap</span><span class="p">)</span>

        <span class="n">glBindTexture</span><span class="p">(</span><span class="n">GL_TEXTURE_3D</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cube_tex</span><span class="p">)</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">minin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">maxin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">minin</span><span class="p">,</span> <span class="n">maxin</span><span class="p">)</span>

            <span class="n">ma</span> <span class="o">=</span> <span class="n">maxin</span> <span class="k">if</span> <span class="n">maxin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">array</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
            <span class="n">mi</span> <span class="o">=</span> <span class="n">minin</span> <span class="k">if</span> <span class="n">minin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">array</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>

            <span class="n">temp</span> <span class="o">=</span> <span class="p">((</span><span class="n">array</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="o">-</span> <span class="n">mi</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">255</span> <span class="o">/</span> <span class="p">((</span><span class="n">ma</span> <span class="o">-</span> <span class="n">mi</span><span class="p">))))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
            <span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="mi">255</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)[</span><span class="n">temp</span><span class="p">]</span>

            <span class="n">glTexImage3D</span><span class="p">(</span><span class="n">GL_TEXTURE_3D</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">GL_RGB</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">GL_RGB</span><span class="p">,</span> <span class="n">GL_UNSIGNED_BYTE</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">array</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Dimension of tex array must be 3 or 4&quot;</span><span class="p">)</span>

        <span class="n">glTexImage3D</span><span class="p">(</span><span class="n">GL_TEXTURE_3D</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">GL_RGB</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">GL_RGB</span><span class="p">,</span> <span class="n">GL_UNSIGNED_BYTE</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">color</span></div>

<div class="viewcode-block" id="GLground.draw_tex_cube"><a class="viewcode-back" href="../../pgutil.html#pgutil.core.GLground.draw_tex_cube">[docs]</a>    <span class="k">def</span> <span class="nf">draw_tex_cube</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">minin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">maxin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mouse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">box</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot;3Dテクスチャを用いて3次元配列を模様付きの立方体として描画する.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        array : array_like</span>
<span class="sd">            描画するデータを格納した3次元配列もしくは4次元配列.</span>
<span class="sd">            3次元配列の場合任意の値を持った配列で, 値に応じた色がカラーマップから選ばれて描画される.</span>
<span class="sd">            4次元配列の場合は4次元目がRGBの順番で色の情報を格納した配列であるとみなす. この場合, 配列の値は[0-1]の範囲に入っている必要がある.</span>
<span class="sd">            Noneの場合, 事前にバインドしたテクスチャがそのまま描画に使用される.</span>
<span class="sd">        minin : float, optional</span>
<span class="sd">            表示の際に最小として表示される値.</span>
<span class="sd">            これより小さい値は黒として表示される.</span>
<span class="sd">            指定がない場合は入力された配列の最小値が使用される.</span>
<span class="sd">            arrayに渡された配列の次元数が4の場合は無視される.</span>
<span class="sd">        maxin : float, optional</span>
<span class="sd">            表示の際に最大として表示される値.</span>
<span class="sd">            これより大きい値はPlayground.colと同じ色で表示される.</span>
<span class="sd">            指定がない場合は入力された配列の最大値が使用される.</span>
<span class="sd">            arrayに渡された配列の次元数が4の場合は無視される.</span>
<span class="sd">        cmap : str, optional</span>
<span class="sd">            描画に使用されるカラーマップ.</span>
<span class="sd">            matplotlibで使用可能なカラーマップ全てと&quot;AVS&quot;, &quot;AVS_r&quot;が使用可能.</span>
<span class="sd">            指定がない場合は&quot;vivid&quot;が選択される.</span>
<span class="sd">            arrayに渡された配列の次元数が4の場合は無視される.</span>
<span class="sd">        mouse : bool, optional</span>
<span class="sd">            描画する立方体の断面をマウス操作によって移動できるようにするかどうか.</span>
<span class="sd">            デフォルト値はFalse.</span>
<span class="sd">        box : tuple of float</span>
<span class="sd">            描画する立方体の各軸の最小, 最大の指定.</span>
<span class="sd">            mouseがTrueの場合は無視される.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">array</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bind_tex_cube</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">minin</span><span class="p">,</span> <span class="n">maxin</span><span class="p">,</span> <span class="n">cmap</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">mouse</span><span class="p">:</span>
            <span class="n">verts</span><span class="p">,</span> <span class="n">tex_cords</span> <span class="o">=</span> <span class="n">_gen_cube</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouseX</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouseY</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
                                         <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">verts</span><span class="p">,</span> <span class="n">tex_cords</span> <span class="o">=</span> <span class="n">_gen_cube</span><span class="p">(</span><span class="o">*</span><span class="n">box</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">draw_with_tex_3d</span><span class="p">(</span><span class="n">verts</span><span class="p">,</span> <span class="n">GL_QUADS</span><span class="p">,</span> <span class="n">tex_cords</span><span class="p">)</span></div>

<div class="viewcode-block" id="GLground.init_lighting"><a class="viewcode-back" href="../../pgutil.html#pgutil.core.GLground.init_lighting">[docs]</a>    <span class="k">def</span> <span class="nf">init_lighting</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;照明システムを初期化する.</span>

<span class="sd">        法線ベクトルを使用した描画の前に呼び出される必要があるが, ほとんどの場合は自動で呼び出される.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">black</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
        <span class="n">white</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
        <span class="n">ambient</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
        <span class="n">diffuse</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
        <span class="n">lightPos</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>

        <span class="n">glMaterialfv</span><span class="p">(</span><span class="n">GL_FRONT_AND_BACK</span><span class="p">,</span> <span class="n">GL_AMBIENT</span><span class="p">,</span> <span class="n">ambient</span><span class="p">)</span>
        <span class="n">glMaterialfv</span><span class="p">(</span><span class="n">GL_FRONT_AND_BACK</span><span class="p">,</span> <span class="n">GL_DIFFUSE</span><span class="p">,</span> <span class="n">diffuse</span><span class="p">)</span>
        <span class="n">glMaterialfv</span><span class="p">(</span><span class="n">GL_FRONT_AND_BACK</span><span class="p">,</span> <span class="n">GL_SPECULAR</span><span class="p">,</span> <span class="n">black</span><span class="p">)</span>

        <span class="n">glLightfv</span><span class="p">(</span><span class="n">GL_LIGHT0</span><span class="p">,</span> <span class="n">GL_AMBIENT</span><span class="p">,</span> <span class="n">white</span><span class="p">)</span>
        <span class="n">glLightfv</span><span class="p">(</span><span class="n">GL_LIGHT0</span><span class="p">,</span> <span class="n">GL_DIFFUSE</span><span class="p">,</span> <span class="n">white</span><span class="p">)</span>
        <span class="n">glLightfv</span><span class="p">(</span><span class="n">GL_LIGHT0</span><span class="p">,</span> <span class="n">GL_SPECULAR</span><span class="p">,</span> <span class="n">white</span><span class="p">)</span>
        <span class="n">glLightfv</span><span class="p">(</span><span class="n">GL_LIGHT0</span><span class="p">,</span> <span class="n">GL_POSITION</span><span class="p">,</span> <span class="n">lightPos</span><span class="p">)</span>

        <span class="n">glLightModelfv</span><span class="p">(</span><span class="n">GL_LIGHT_MODEL_AMBIENT</span><span class="p">,</span> <span class="n">black</span><span class="p">)</span>

        <span class="n">glEnable</span><span class="p">(</span><span class="n">GL_NORMALIZE</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">light_initialized</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">screenmodefuncs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init_lighting</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">light_initialized</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="GLground.clear_tex_cache"><a class="viewcode-back" href="../../pgutil.html#pgutil.core.GLground.clear_tex_cache">[docs]</a>    <span class="k">def</span> <span class="nf">clear_tex_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;テクスチャ番号のキャッシュを削除する.</span>

<span class="sd">        画面モードが切り替わった際に自動で呼び出される.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text_cache</span> <span class="o">=</span> <span class="p">{}</span></div>

    <span class="k">def</span> <span class="nf">_reload_3d_tex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_bind_func</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_bind_func</span><span class="p">()</span></div>


<span class="kn">from</span> <span class="nn">pygame</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">pygame.gfxdraw</span> <span class="k">as</span> <span class="nn">gfxdraw</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">pgutil 1.0.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, M.Yusuke.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.4.
    </div>
  </body>
</html>